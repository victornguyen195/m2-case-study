<?php
/**
 * @var Amasty\ThankYouPage\Block\Onepage\Success\Types\CreateAccount $block
 * @var Magento\Framework\Escaper $escaper
 */

try {
    $background = $escaper->escapeHtml($block->getBackgroundImage());
} catch (\Magento\Framework\Exception\NoSuchEntityException $e) {
    return;
}
$background = $background ? " style=background-image:url(\"$background\")" : '';
$requiredDob = $block->getShowDob() === 'req' ? 'required' : '';
?>

<div class="amtyblock amtyblock-customer-create" style="width: <?= $escaper->escapeHtml($block->getWidth()) . '%' ?>">
    <div id="thankyoupage-customer-create">
        <div<?= $escaper->escapeHtml($background); ?> class="amtypage-background">
            <?php if (!$block->useCmsBlock()): ?>
                <h2 class="page-title">
                    <?= $escaper->escapeHtml($block->getTitle()); ?>
                </h2>
                <?php if ($block->getSubTitle()): ?>
                    <p class="subtitle"><?= $escaper->escapeHtml($block->getSubTitle()); ?></p>
                <?php endif; ?>

                <?php if ($block->getText()): ?>
                    <p class="text"><?= $escaper->escapeHtml($block->getText()); ?></p>
                <?php endif; ?>
            <?php else: ?>
                <div class="content">
                    <?= /* @noEscape */ $block->getCmsBlockContentHtml(); ?>
                </div>
            <?php endif; ?>
        </div>
        <div class="content">
            <form id="thankyoupage-customer-create-form"
                  class="container-form form thankyoupage-customer-create-form"
                  novalidate
                  action="<?= $escaper->escapeUrl($block->getFormActionUrl()) ?>"
                  method="post"
                  data-mage-init='{
                      "validation": {},
                      "amThankYouPageCreateAccountForm": {
                          "successContainerSelector": "#thankyoupage-customer-create .container-success",
                          "errorContainerSelector": "#thankyoupage-customer-create .error"
                      }
                  }'>
                <fieldset class="fieldset">
                    <?php if ($block->isEmailFieldVisible()): ?>
                        <div class="field create-account-email required">
                            <label class="label" for="create-account-email">
                                <?= $escaper->escapeHtml(__('Email:')) ?>
                            </label>
                            <div class="control">
                                <input name="create_account_email" type="email" id="create-account-email"
                                       placeholder="<?= $escaper->escapeHtml(__('Enter your email address')) ?>"
                                       value="<?= $escaper->escapeHtml($block->getOrderEmail()) ?>"
                                       data-validate="{required:true, 'validate-email':true}"/>
                            </div>
                        </div>
                    <?php endif; ?>

                    <?php if (!$block->isPasswordAutoGenerated()): ?>
                        <div class="field password required">
                            <label for="password" class="label"><?= $escaper->escapeHtml(__('Password')) ?></label>
                            <div class="control">
                                <input type="password" name="password" id="password"
                                       title="<?= $escaper->escapeHtml(__('Password')) ?>"
                                       class="input-text"
                                       data-password-min-length="<?= $escaper->escapeHtml($block->getMinimumPasswordLength()) ?>"
                                       data-password-min-character-sets="<?= $escaper->escapeHtml($block->getRequiredCharacterClassesNumber()) ?>"
                                       data-validate="{required:true, 'validate-customer-password':true}"
                                       autocomplete="off"/>
                                <div id="password-strength-meter-container"
                                     data-role="password-strength-meter"
                                     aria-live="polite">
                                    <div id="password-strength-meter" class="password-strength-meter">
                                        <?= $escaper->escapeHtml(__('Password Strength')) ?>:
                                        <span id="password-strength-meter-label" data-role="password-strength-meter-label">
                                            <?= $escaper->escapeHtml(__('No Password')) ?>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="field confirmation required">
                            <label for="password-confirmation" class="label">
                                <?= $escaper->escapeHtml(__('Confirm Password')) ?>
                            </label>
                            <div class="control">
                                <input type="password" name="password_confirmation"
                                       title="<?= $escaper->escapeHtml(__('Confirm Password')) ?>"
                                       id="password-confirmation" class="input-text"
                                       data-validate="{required:true, equalTo:'#password'}" autocomplete="off"/>
                            </div>
                        </div>
                    <?php endif; ?>

                    <?php if ($block->getShowDob()): ?>
                        <div class="field date field-dob <?= $escaper->escapeHtml($requiredDob) ?>">
                            <label class="label" for="dob"><?= $escaper->escapeHtml(__('Date of Birth')) ?></label>
                            <div data-bind="scope: 'amasty-thank-you-page-dob'">
                                <!-- ko template: getTemplate() --><!-- /ko -->
                            </div>
                        </div>
                    <?php endif; ?>

                    <?php if ($block->isTermsAndConditionsVisible()): ?>
                        <div class="field choice required">
                            <input type="checkbox" name="create-account-terms-and-conditions"
                                   id="create-account-terms-and-conditions"
                                   title="<?= $escaper->escapeHtml(__('I accept terms & conditions')) ?>"
                                   value="1" class="checkbox"
                                   data-validate="{required:true}"/>
                            <label for="create-account-terms-and-conditions" class="label">
                                <?= $escaper->escapeHtml(__('I accept terms & conditions')) ?>
                            </label>
                        </div>
                    <?php endif; ?>

                    <?php if ($terms = $block->getTermsText()): ?>
                        <p><?= $escaper->escapeHtml($terms); ?></p>
                    <?php endif; ?>

                    <div class="actions">
                        <button class="action submit"
                                title="<?= $escaper->escapeHtml(__('Create Account')) ?>"
                                aria-label="<?= $escaper->escapeHtml(__('Create Account')) ?>"
                                type="submit">
                            <?= $escaper->escapeHtml(__('Create Account')) ?>
                        </button>
                    </div>
                </fieldset>
            </form>

            <div class="error" style="display: none"></div>
            <div class="container-success" style="display: none"></div>
        </div>

        <script type="text/x-magento-init">
        {
            "*": {
                "Magento_Ui/js/core/app": <?= /** @escapeNotVerified */ $block->getJsLayout();?>
            },
            ".field.password": {
                "passwordStrengthIndicator": {
                    "formSelector": "form.form-create-account"
                }
            }
        }
        </script>
    </div>
</div>
